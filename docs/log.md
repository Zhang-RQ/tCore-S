## 11.17

### Rust-fatfs

- `OemCpConverter`: Provides a custom implementation for a short name encoding/decoding.
- `TimeProvider`: A current time and date provider. Provides a custom implementation for a time resolution used when updating directory entry time fields.

### maturin

- File system object: A memory mapped device.
- Why get cpu id from `tp`? Why not `mhartid` register?
- `fscommon::BufStream` derived `Read`, `Write` and `Seek` traits. Why use BufStream but not a custom block cache.

## 11.19

trait **object**?

[Object Safety](https://doc.rust-lang.org/reference/items/traits.html#object-safety)
[RFC](https://github.com/rust-lang/rfcs/blob/master/text/0255-object-safety.md)

- Can have a method that does not use `Self` except in the type of the receiver:
  - No `Self` return
  - No `Self` parameters
- Cannot have a associative `const`.
- Cannot have associated function without `Sized`.
- `Self: Sized` traits are not object-safe.
- Not object safe if `Self` is a type argument.

```rust
trait Foo {
    fn method1(&self);
    fn method2(&mut self, x: i32, y: String) -> usize;
}

// autogenerated impl
impl<'a> Foo for Foo+'a {
    fn method1(&self) {
        // `self` is an `&Foo` trait object.

        // load the right function pointer and call it with the opaque data pointer
        (self.vtable.method1)(self.data)
    }
    fn method2(&mut self, x: i32, y: String) -> usize {
        // `self` is an `&mut Foo` trait object

        // as above, passing along the other arguments
        (self.vtable.method2)(self.data, x, y)
    }
}
```